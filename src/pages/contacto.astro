---
import Layout from "../layouts/Layout.astro";

const keyHcaptcha: string = import.meta.env.PUBLIC_HCAPTCHA_SITE_KEY ?? '';

const contactDetails = [
  {
    icon: "fas fa-phone-alt",
    title: "Llámanos",
    value: "+56 9 7622 5094",
    href: "tel:+56976225094",
    bgColor: "bg-yellow-100",
    textColor: "text-yellow-600"
  },
  {
    icon: "fas fa-envelope",
    title: "Solange Roco",
    value: "roco.solange@automotiveconsulting.cl",
    href: "mailto:roco.solange@automotiveconsulting.cl",
    bgColor: "bg-blue-100",
    textColor: "text-blue-600"
  },

];

const locations = [
    {
        name: "Sucursal Las Condes",
        address: "Camino El Alba 8760, of 304, Santiago, Chile.",
        mapSrc: "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3330.643601299168!2d-70.5445616!3d-33.406461199999995!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x9662cebdfd27eea9%3A0x40570cf4853f3d07!2sCam.%20El%20Alba%208760%2C%20OF%20304%2C%20Las%20Condes%2C%20Regi%C3%B3n%20Metropolitana!5e0!3m2!1ses-419!2scl!4v1759939102145!5m2!1ses-419!2scl"
    },
    {
        name: "Sucursal Macul",
        address: "Auto Park, Av. Departamental 4400, Santiago, Chile.",
        mapSrc: "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3332.494026174804!2d-70.5212702245882!3d-33.358166192791614!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x9662cbddbea05483%3A0x434445016ab52c5c!2sAv.%20La%20Dehesa%201500%2C%20Torre%202%2C%20piso%204%2C%20oficina%208%2C%207690253%20Santiago%2C%20Lo%20Barnechea%2C%20Regi%C3%B3n%20Metropolitana!5e0!3m2!1ses-419!2scl!4v1753760354023!5m2!1ses-419!2scl7"
    },
    {
        name: "Sucursal Viña del Mar",
        address: "Auto Park, Cam. Internacional 3500, Viña del Mar, Valparaíso, Chile.",
        mapSrc: "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3332.494026174804!2d-70.5212702245882!3d-33.358166192791614!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x9662cbddbea05483%3A0x434445016ab52c5c!2sAv.%20La%20Dehesa%201500%2C%20Torre%202%2C%20piso%204%2C%20oficina%208%2C%207690253%20Santiago%2C%20Lo%20Barnechea%2C%20Regi%C3%B3n%20Metropolitana!5e0!3m2!1ses-419!2scl!4v1753760354023!5m2!1ses-419!2scl8"
    }
]
---

<Layout 
  title="Contacto - Automotive Consulting" 
  description="Escríbenos si tienes alguna duda o si quieres vender tu automovil de forma segura y confiable." 
  image="/image-service-01.webp"
>
  <section class="bg-white py-24 pt-48">
    <div class="md:w-7xl mx-auto px-4 text-center">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">Hablemos</h1>
      <p class="text-lg text-gray-600 max-w-3xl mx-auto">
        Escríbenos si tienes alguna duda o si quieres vender tu automóvil de forma segura y confiable con nosotros.
      </p>
    </div>
  </section>

  <main class="bg-gray-50 py-16 px-4">
    <div class="max-w-7xl mx-auto">
      
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-12 mb-20">
        <div class="lg:col-span-2 bg-white rounded-2xl shadow-lg p-8 md:p-12">
            <h2 class="text-3xl font-bold text-gray-900 mb-6">Envíanos un mensaje</h2>
            <form id="contact-form" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <label for="name" class="block text-sm font-semibold text-gray-900 mb-2">Nombre completo</label>
                      <input type="text" id="name" name="name" required placeholder="Tu nombre" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-ac-blue transition-all" />
                    </div>
                    <div>
                      <label for="phone" class="block text-sm font-semibold text-gray-900 mb-2">Teléfono</label>
                      <input type="tel" id="phone" name="phone" required placeholder="+56 9 1234 5678" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-ac-blue transition-all" />
                    </div>
                </div>
                <div>
                    <label for="email" class="block text-sm font-semibold text-gray-900 mb-2">Correo electrónico</label>
                    <input type="email" id="email" name="email" required placeholder="tu@email.com" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-ac-blue transition-all" />
                </div>
                <div>
                    <label for="message" class="block text-sm font-semibold text-gray-900 mb-2">Mensaje</label>
                    <textarea id="message" name="message" rows="5" required placeholder="Cuéntanos en qué podemos ayudarte..." class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-ac-blue transition-all resize-none"></textarea>
                </div>
                
                <div class="h-captcha" data-sitekey={keyHcaptcha}></div>
                <div id="form-status" class="hidden" aria-live="polite"><p class="text-center font-medium"></p></div>
                
 <button
                type="submit"
                class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-8 rounded-xl transition-all duration-200 transform hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 shadow-lg"
              >
                Enviar mensaje
              </button>
            </form>
        </div>

        <div class="space-y-8">
            <div>
                <h3 class="text-2xl font-bold text-gray-900 mb-6">Contacto Directo</h3>
                <div class="space-y-4">
                    {contactDetails.map(item => (
                    <a href={item.href} target="_blank" class="flex items-center space-x-4 bg-white p-4 rounded-xl shadow-md hover:shadow-lg hover:-translate-y-1 transition-all duration-300">
                        <div class:list={["flex-shrink-0 w-12 h-12 rounded-lg flex items-center justify-center", item.bgColor]}>
                        <i class:list={[item.icon, item.textColor, "text-xl"]}></i>
                        </div>
                        <div>
                        <p class="text-sm font-semibold text-gray-900">{item.title}</p>
                        <p class="text-gray-600 text-sm break-all">{item.value}</p>
                        </div>
                    </a>
                    ))}
                </div>
            </div>
            <div>
                <h3 class="text-2xl font-bold text-gray-900 mb-6">¿Por qué elegirnos?</h3>
                <ul class="space-y-3 text-gray-700">
                    <li class="flex items-center"><div class="w-2 h-2 bg-ac-blue rounded-full mr-3"></div>Crédito automotriz</li>
                    <li class="flex items-center"><div class="w-2 h-2 bg-ac-blue rounded-full mr-3"></div>La mejor tasa de interés</li>
                    <li class="flex items-center"><div class="w-2 h-2 bg-ac-blue rounded-full mr-3"></div>Garantía</li>
                </ul>
            </div>
        </div>
      </div>

      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-gray-900">Nuestras Sucursales</h2>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        {locations.map(loc => (
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden transform hover:-translate-y-1.5 transition-transform duration-300">
                <div class="p-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-2">{loc.name}</h3>
                    <p class="text-gray-600 flex items-start"><i class="fas fa-map-marker-alt text-ac-blue mt-1 mr-2"></i>{loc.address}</p>
                </div>
                <div class="aspect-w-16 aspect-h-9 bg-gray-200">
                    <iframe
                        src={loc.mapSrc}
                        width="100%"
                        height="300"
                        style="border:0;"
                        allowfullscreen=""
                        loading="lazy"
                        referrerpolicy="no-referrer-when-downgrade"
                    ></iframe>
                </div>
            </div>
        ))}
      </div>

    </div>
  </main>
</Layout>

<!-- hCaptcha script -->
<script src="https://js.hcaptcha.com/1/api.js" async defer></script>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const formStatus = document.getElementById('form-status');
  const statusText = formStatus?.querySelector('p');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    if (!form || !formStatus || !statusText) return;

    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());

    // Disable form and show loading state
    const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement;
    const originalText = submitButton.textContent;
    
    form.querySelectorAll('input, textarea, button').forEach((el) => {
      (el as HTMLElement).setAttribute('disabled', 'true');
    });
    
    submitButton.textContent = 'Enviando...';
    formStatus.classList.remove('hidden');
    statusText.textContent = 'Enviando mensaje...';
    formStatus.className = 'text-gray-600 text-center p-4 bg-gray-50 rounded-xl';

    try {
      const response = await fetch('/api/send-email', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      });

      const result = await response.json();

      if (result.error) {
        throw new Error(result.error);
      }

      // Show success message
      form.reset();
      statusText.textContent = '¡Mensaje enviado con éxito! Nos pondremos en contacto contigo pronto.';
      formStatus.className = 'text-green-700 text-center p-4 bg-green-50 rounded-xl border border-green-200';
      
      // Reset form after 5 seconds
      setTimeout(() => {
        formStatus.classList.add('hidden');
      }, 5000);
    } catch (error) {
      // Show error message
      statusText.textContent = 'Error al enviar el mensaje. Por favor, intenta nuevamente o contáctanos directamente.';
      formStatus.className = 'text-orange-700 text-center p-4 bg-orange-50 rounded-xl border border-orange-200';
    } finally {
      // Re-enable form
      form.querySelectorAll('input, textarea, button').forEach((el) => {
        (el as HTMLElement).removeAttribute('disabled');
      });
      submitButton.textContent = originalText;
    }
  });
</script>